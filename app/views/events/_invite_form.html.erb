<%= form_tag(send_invitation_path, class: 'form_margin',id: 'invite_friends_form') do %>
    <%= hidden_field_tag(:event_id, @event.id) %>
    <%= hidden_field_tag(:friend_emails) %>
    <div class="col-md-12 invitation_text">
      <label></label>
      <div id="tags" class="tags_wrap">
        <input type="text" name="emails_autocomplete" placeholder="Enter email with comma separated" class="biginput" id="emails_autocomplete">
      </div>
    </div>
    <div class="col-md-4"></div>
    <div class="col-md-4">
      <label></label>
      <a href="<%= event_url(@event) %>" class="btn btn-lg btn-primary btn-block invite_btn_cancel" type="submit">CANCEL</a> </div>
    <div class="col-md-4">
      <label></label>
      <%= submit_tag("INVITE",class: 'btn btn-lg btn-primary btn-block upload_btn_done') %>
    </div>
<% end  %>

<script type="text/javascript">






  $('#invite_friends_form  #tags input').on('focusout',function(){    
    var txt= this.value.replace(/\,/g,''); // allowed characters


      function validateEmail(txtEmail){
          var a = txtEmail
          var filter = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
          if(filter.test(a)){
              return true;
          }
          else{
              txt=""
              return false;
          }
      }

              if(validateEmail(txt))
              {
                  //alert('Email is valid');
              }
              else
              {
                  alert('Invalid Email Address');
              }

      // //  EMAIL VALIDATION.   STARTS.....
    // var atpos = txt.indexOf("@");
    // var dotpos = txt.lastIndexOf(".");
    // if (atpos< 1 || dotpos<atpos+2 || dotpos+2>=txt.length) {
    //     alert("Not a valid e-mail address");
    //     this.value = "";
    //     return false;
    // }
    // //  EMAIL VALIDATION.   ENDS.....

    if(txt) {

      $(this).before('<span class="tag">'+ txt.toLowerCase() +'</span>');
    }
    this.value="";
  }).on('keyup',function( e ){
    // if: comma,enter (delimit more keyCodes with | pipe)
    if(/(188|13)/.test(e.which)) $(this).focusout(); 

  });
  
  
  $('#invite_friends_form #tags').on('click','.tag',function(){
     if(confirm("Do you want to remove invitee's email address?")) $(this).remove();
  });
  
  $('#invite_friends_form  .tags_wrap').click(function() {
         $('#tags input').focus();
  })

  $("#invite_friends_form").submit(function(e) {  
    emails = []
    $('#tags').children('.tag').each(function () {
     emails.push($(this).text()); // "this" is the current element in the loop
    });
    $('#friend_emails').val(emails.join()) 
  })

</script>

<style type="text/css">
#tags input{
  background:#eee;
  border:0;
  margin:4px;
  padding:7px;
  width:auto;
  background-color:transparent;
  outline:none;
  /*dinesh to increase text length for placeholder in events/_invite_form.html */
  width: 270px;
}
</style>