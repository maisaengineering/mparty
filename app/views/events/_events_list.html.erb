<div id="events">
  <div class="page">
    <% if events.present? %>
        <% events.each do |e| %>
            <div class="col-xs-12 col-sm-6 col-md-3 event">
              <div class=" row nomargin event_margin">
                <div class="event_img">
                  <% if e.pictures.present? %>
                      <%=link_to(image_tag(e.pictures.first.image.url(:preview)), "events/#{e.id}", class: "thumbnail") %>
                  <% else %>
                      <%=link_to(image_tag("event_2.jpg"), "events/#{e.id}", class: "thumbnail") %>
                  <% end %>
                  <div class="event_name">
                    <p><%= e.name%></p>
                  </div>
                  <div class="event_details">
                    <div class="event_date"><span class="glyphicon glyphicon-calendar"></span>
                      <% if e.starts_at== Date.today %>
                          Today
                      <% else %>
                          <%= e.starts_at.strftime("%d/%m/%y")%>
                      <% end %>
                      <div class="pull-right"><%= e.start_time.try(:strftime, '%I:%M %p')%></div>
                    </div>
                    <div class="event_place">
                      <div class="pull-left">
                        <span class="glyphicon glyphicon-map-marker"></span>
                        <%= truncate(e.location.camelcase ,length: 20) %>
                      </div>
                      <!-- Only public events are allowed for joining a event -->
                      <% if e.is_public? %>
                          <% if spree_current_user and e.user_joined?(spree_current_user) %>
                              <div class="pull-right unjoin_btn" >
                                <%= link_to "Leave this Event", "/events/#{e.id}/disjoin" ,method: :delete%>
                              </div>
                          <% else %>
                              <div class="pull-right join_btn" >
                                <%= link_to "Join", "/events/#{e.id}/join" ,method: :post%>
                              </div>
                          <% end  %>
                      <% else %>
                          <div class="pull-right text-info"> <span class="glyphicon glyphicon-lock"></span>Private</div>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        <% end %>
    <% end %>
  </div>
</div>
<%= paginate events ,params: {query: params[:query],type: params[:type] || 'trending' }%>